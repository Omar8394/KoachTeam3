{% extends "layouts/base.html" %}

{% block title %}{% endblock %}
<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}

{% endblock stylesheets %}

{% block content %}
<div class="content">
    <div class="page-inner animated fadeInRight">
        <div class="page-header">
            <h4 class="page-title">Academic</h4>
            <ul class="breadcrumbs">
                <li class="nav-home">
                    <a href="{% url 'home' %}">
                        <i class="flaticon-home"></i>
                    </a>
                </li>
                <li class="separator">
                    <i class="flaticon-right-arrow"></i>
                </li>
                <li class="nav-item">
                    <a href="{% url 'professors' %}">Professors' Assignment</a>
                </li>
            </ul>
        </div>
        <div class="page-category">
            <div class="card">
                <div class="card-header">
                
                    <h2>Professors</h2>
                    <div class="form-group">
                        <div class="input-group">
                            <input id="txtSearch" type="text" class="form-control" placeholder="Search for....">
                            <div class="input-group-append">
                                <span id="clearBtn" class="btn btn-danger">
                                    <i class="fa fa-broom"></i>
                                </span>
                                <span id="searchBtn" class="btn btn-primary">
                                    <i class="fa fa-search"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <main class="card-body is-loading-lg">
               

                </main>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="addNewModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div id="addNewModalContent" class="modal-dialog  modal-dialog-centered" role="document">

    </div>
</div>

{% endblock content %}

{% block javascripts %}
<script>
   let editmode = false
   let query = ""
   let selectedId = ""
   let id_Course="{{id_corso}}"

   
   const renderContent = ()=>{
       document.querySelector("main.card-body").classList.add("is-loading")
       fetch("{% url 'contentProfessors'%}", {
          ...fetchObject,
          body: JSON.stringify({
             query,
             id_Course
          })
       })
       .then(async(res)=>{
          result = await res.text()
          document.querySelector("main.card-body").classList.remove("is-loading")
          document.querySelector("main.card-body").innerHTML = result
       })
   }
   renderContent()
  
   const updateModel = (url, method, data, codigo ) => {
       return fetch(url, {
          ...fetchObject,
          body: JSON.stringify({
             method,
             data,
             codigo
          })
       })
   }

   const clickSave = (formElement, url) => {
      const formData = new FormData(formElement);
      const data = {}
      for (var [key, value] of formData.entries()) {
         data[key] = value
      }
         return updateModel(url, "save", data, "false")
            .then(async (res) => {
               const text = JSON.parse(await res.text())
               if (text.message == "error") alerta(5)
               else alerta(1)
            })
      
    }

   function cambiar_comb() {
    
        const varia= document.getElementById("categoryProgram").value;
        const url= '/help_app/micombobox/?valor='+varia;
        fetch(url)
        .then( function(result) {
            return result.text();
        })
        .then( function(result){
            document.getElementById("categoriasProcess").innerHTML=result;    
        });

    } 

    

    function cambiar_comb1() {
    
        const varia= document.getElementById("categoriasProcess").value;
        const url= '/help_app/micombobox/?valor='+varia;
        fetch(url)
        .then( function(result) {
            return result.text();
        })
        .then( function(result){
            document.getElementById("categoriasUnit").innerHTML=result;    
        });

    } 

    function cambiar_comb2() {
    
    const varia= document.getElementById("categoriasUnit").value;
    const url= '/help_app/micombobox/?valor='+varia;
    fetch(url)
    .then( function(result) {
        return result.text();
    })
    .then( function(result){
        document.getElementById("categoriasCourse").innerHTML=result;    
    });

    } 

    function comboFinal() {
    
       id_Course= document.getElementById("categoriasCourse").value;
       
    } 

    const openSaveProf = (id) => {
        console.log(id)
        fetch("{% url 'save'%}", {
        ...fetchObject,
        body: JSON.stringify({
             method:" ",
             codigo:"true",
             id,
             id_Course
          })
            
        })
         .then(async (res) => {
            document.getElementById("addNewModalContent").innerHTML = await res.text()
         })
         .then(() => {
            $("#addNewModal").modal("show")
            const formSave = document.getElementById("formSave")
            formSave.addEventListener("submit", (e) => {
               e.preventDefault()
               clickSave(formSave, "{% url 'save' %}")
                  .then(() => {
                     $("#addNewModal").modal("hide")
                     renderContent()
                  })
            })
         })

    }


   const openAddCourso = () => {
      editmode = false
      fetch("{% url 'addProfessors'%}", {
         ...fetchObject,
         body: JSON.stringify({
            query:" cristo vive "
         })
         
      })
         .then(async (res) => {
            document.getElementById("addNewModalContent").innerHTML = await res.text()

         })
         .then(() => {
            $("#addNewModal").modal("show")
            
             
         })
    }


   const searchFor = (text) =>{
       let output = text.trim()
       if(output.length > 20) return
       query = output
       renderContent()
   }
    
    
   const searchBar = document.querySelector('#txtSearch')
   const clearBtn = document.querySelector('#clearBtn')
   const searchBtn = document.querySelector('#searchBtn')
    
   clearBtn.addEventListener('click', ()=>{
       searchBar.value = ""
       query = ""
       searchFor("")
    })
   searchBtn.addEventListener('click', ()=>{
       searchFor(searchBar.value)
    })
   searchBar.addEventListener('keypress', (e) => {
       if (e.key === 'Enter') {
          searchFor(searchBar.value)
      }
   });


   

</script>
{% endblock javascripts %}