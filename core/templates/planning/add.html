{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

    <div class="content">
		<div class="page-inner">
			<div class="page-header">
				<h4 class="page-title">Profilages</h4>
				<ul class="breadcrumbs">
					<li class="nav-home">
						<a href="{% url 'home' %}">
							<i class="flaticon-home"></i>
						</a>
					</li>
					<li class="separator">
						<i class="flaticon-right-arrow"></i>
					</li>
					<li class="nav-item">
						<span>Planning</span>
					</li>
					<li class="separator">
						<i class="flaticon-right-arrow"></i>
					</li>
					<li class="nav-item">
						<a href="{% url 'showProfilage' %}">Profilage</a>
					</li>
					<li class="separator">
						<i class="flaticon-right-arrow"></i>
					</li>
					<li class="nav-item">
						<a href="#">Add</a>
					</li>
				</ul>
			</div>
			<div class="page-category">
           	 	<div class="card">
					<div class="card-header">
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <h2 class="card-text mt-2">
                                   New profilage
                                </h2>
                            </div>
                        </div>
					</div>
                    {% include 'planning/formularios.html' with form=form %}    
				</div>        
      		</div>
		</div>
	</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script>
	var t;    
	function myCallback()
	{
		$.ajax({
			data: $('#formulario').serialize(),
			url: "{% url 'validate_username' %}",
			success: function (response) {
				if (response.message != null) {
					$('#id_username').removeClass('is-valid').addClass('is-invalid');
					if(!$('#usernameError').length)
						$('#id_username').after('<div class="invalid-feedback d-block" id="usernameError">' + response.message + '</div>')
				}
				else if($('#id_username').val()){
					$('#id_username').removeClass('is-invalid').addClass('is-valid');
					if($('#usernameError').length)
						$('#usernameError').remove();

				}else{
					$('#id_username').removeClass('is-invalid').removeClass('is-valid');
					if($('#usernameError').length)
						$('#usernameError').remove();

				}

			},
			error: function (response) {
				console.log(response.responseJSON.errors)
			}
		});
	}

	$(document).ready(function () {
		$('#id_username').keyup(function () {  
		
			if ( t )
			{
				clearTimeout( t );
				t = setTimeout( myCallback, 1000 );
			}
			else
			{
				t = setTimeout( myCallback, 1000 );
			}

			return false;
		});
		
	})

	// $('#formulario').on('submit', function(e){
             
	// 	if($('#formulario').find('.is-invalid').val()){
			
	// 		e.preventDefault();
	// 		swal({
	// 			title: 'Error!',
	// 			text: 'An error has occurred.',
	// 			icon: 'error',
	// 			buttons: {
	// 				confirm: {
	// 					className: 'btn btn-danger'
	// 				}
	// 			}
	// 		}).then((value) => {$('#formulario').find('.is-invalid').focus()});
	// 	}
			 
	// });



</script>

{% endblock javascripts %}
