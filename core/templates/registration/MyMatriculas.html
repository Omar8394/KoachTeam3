{% extends "layouts/base.html" %}

{% block title %}{% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

	<div class="content">
		<div class="page-inner">
			<div class="page-header">
				<h4 class="page-title">Starter page</h4>
				<ul class="breadcrumbs">
					<li class="nav-home">
						<a href="index.html">
							<i class="flaticon-home"></i>
						</a>
					</li>
					<li class="separator">
						<i class="flaticon-right-arrow"></i>
					</li>
					<li class="nav-item">
						<span>Module name</span>
					</li>
					<li class="separator">
						<i class="flaticon-right-arrow"></i>
					</li>
					<li class="nav-item">
						<a href="#">Page 1</a>
					</li>
				</ul>
			</div>
			<div class="page-category">
        <h2>Enrollment Applications</h2>
		<div > 
			<div class="dropdown" id="panelBuscar">
                <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    <i class="glyphicon glyphicon-search"></i> Filter
                   
                </button>
                <div class="dropdown-menu">
                    <div class="panel">
                        <div class="panel-body">
                            <form id="buscar" name="buscar" method="POST" action=".">
				{% csrf_token %}
                                 
                            <table style="width:100%">
                           
                                <tr>
                                    <td>Initial Date</td>
                                    <td></td>
                                    <td>
                                        <input id="fechaInicial" name="fechaInicial" type="date" class="form-control" >
                                    </td>
                                </tr>
                                <tr>
                                    <td>Final Date</td>
                                    <td></td>
                                    <td>
                                        <input id="fechaFinal" name="fechaFinal" id type="date" class="form-control" >
                                    </td>
                                </tr>
                               
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td>
                                        

                                        <input type="submit" class="btn btn-primary" value="Filter" >
                                        &nbsp;
                                        <input type="button" onclick="reload()" class="btn btn-default" value="Clean">

                                    </td>
                                </tr>
                            </table>
                        </form>
                        </div>
                    </div>
                </div>

            </div>

            <div class="animated fadeInRight">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <table class="table table-striped table-hover">
                            <thead>
            
                                <tr>
                                    <th style="width: 65px;"></th>
                                   
                                    <th>Applicant</th>
                                    <th>Status </th>
                                    <th>Date of application</th>
                                    <th>Program</th>
                                    <th>Payment</th>

                                    <th></th>

                                  
                                </tr>
                            </thead>
                            <tbody class="data-cargando">
                                {% for mat in matriculasList %}
            
                                <tr style="cursor:pointer;" id="{{mat.idmatricula_alumnos}}"   >
                                    <td ></td>
                                   <td>{{mat.fk_publico}}</td>
                                   <td>{{mat.fk_status_matricula}}</td>

                                   <td>{{mat.fecha_matricula}}</td>
                                   <td>{{mat.fk_estruc_programa}}</td>
                                   <td onclick="showModalPago('{{mat.fk_estruc_programa.idestructuraprogrmas}}' )">
                                       <span class="fas fa-credit-card">Payment </span>
                                   </td>




                                    <td>
                                     
                                   
                                    </td>
                                </tr>

                                {% endfor %}
                            </tbody>
                        </table>

                        {% comment "Optional note" %}
                        
                        <div class="pagination" style="text-align: center;">
                            <span class="step-links" style="display:table;
                            margin:0 auto; ">
                                {% if matriculasList.has_previous %}
                                    <a href="?page=1">&laquo; first</a>
                                    <a href="?page={{ matriculasList.previous_page_number }}">previous</a>
                                {% endif %}
                        
                                <span class="current">
                                    Page {{ matriculasList.number }} of {{ matriculasList.paginator.num_pages }}.
                                </span>
                        
                                {% if matriculasList.has_next %}
                                    <a href="?page={{ matriculasList.next_page_number }}">next</a>
                                    <span class="fa-fast-forward"></span>
                                    <a  href="?page={{ matriculasList.paginator.num_pages }}">last &raquo;</a>
                                {% endif %}
                            </span>
                        </div>

                       {% endcomment %}
                       

                        <nav aria-label="Page navigation example">
                            <ul class="pagination justify-content-center">
                            {% if matriculasList.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1">&laquo; First</a>

                               </li>
                                <li class="page-item">
                                  

                                <a class="page-link" href="?page={{ matriculasList.previous_page_number }}">Previous</a>
                              </li>
                            {% else %}
                                <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                              </li>
                            {% endif %}
                    
                            {% if matriculasList.number|add:'-4' > 1 %}
                                <li class="page-item"><a class="page-link" href="?page={{ matriculasList.number|add:'-5' }}">&hellip;</a></li>
                            {% endif %}
                    
                            {% for i in matriculasList.paginator.page_range %}
                                {% if matriculasList.number == i %}
                                    <li class="page-item active" aria-current="page">
                                  <span class="page-link">
                                    {{ i }}
                                    <span class="sr-only">(current)</span>
                                  </span>
                                </li>
                                {% elif i > matriculasList.number|add:'-5' and i < matriculasList.number|add:'5' %}
                                     <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                                {% endif %}
                            {% endfor %}
                    
                            {% if matriculasList.paginator.num_pages > matriculasList.number|add:'4' %}
                               <li class="page-item"><a class="page-link" href="?page={{ matriculasList.number|add:'5' }}">&hellip;</a></li>
                            {% endif %}
                    
                            {% if matriculasList.has_next %}
                                <li class="page-item">
                                <a class="page-link" href="?page={{ matriculasList.next_page_number }}">Next</a>
                              </li>
                              <li class="page-item">
                                <a class="page-link" href="?page={{ matriculasList.paginator.num_pages }}">Last &raquo;</a>
                              </li>

                            {% else %}
                                <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Next</a>
                              </li>
                            {% endif %}
                          </ul>
                        </nav>

                        <div class="clearfix"></div>
            
                    </div>
                </div>
            
            
            </div>
            














	   
		</div>			            
      </div>
		</div>
	</div>


<script>

var matricula=0;
function showModal(id){
    matricula=id;






let url='MatriculacionAdminModal/?matricula='+id;
fetch(url,{
	mode: 'no-cors',
  method: 'get'
}).then(function(result){

return result.text();

}).then(function(result){
	
	let unit=document.getElementById("modalContent").innerHTML=result;

});
    $("#AdministrarMatricula").modal("show");
    
  
}

function enviar(){

var xhr = new XMLHttpRequest();
xhr.open("POST", "updateEnrollment/"); 
xhr.onload = function(event){ 
alerta("Success, server responded with: " + event.target.response); // raw response
location.href = "" ;
}; 
// or onerror, onabort
var formData = new FormData(document.getElementById("enroll")); 
formData.append('id', matricula);
xhr.send(formData);




}

function reload(){

    window.location.href="{% url 'EnrollmentList'%}";
}


</script>



<!--Buscar Personas DB Modal-->
<div class="modal fade" tabindex="-1" role="dialog" id="PayMatricula">
    <div class="modal-dialog modal-lg" role="document" id="modalContent">
     
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->

<!-- /.modal -->


<!--Buscar Personas DB Modal-->
<div class="modal fade" tabindex="-1" role="dialog" id="PayMatriculaPaypal">
    <div class="modal-dialog modal-lg" role="document" id="modalContentPaypal">
     
        
      
  <div class="modal-content" onload="Carga()">
    <div class="modal-header">
        <h4 style="left: initial;" class="modal-title">Enrollment Details</h4>

        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    </div>
    <div class="modal-body">
        
            <div class="row">
                
                    <div class="col-12">
                        
                           
                   
                 
                    <div class="form-group">
                        <div >
                            <div class="">
                                <div class="">
                
                                   <div id="smart-button-container">
                  <div style="text-align: center;">
                  
                
                       <div id="smart-button-container">
                  <div style="text-align: center;">
                    <div id="paypal-button-container"></div>
                  </div>
                </div>
                
                
                         
                
                                    <center>
                                     <input type="hidden" id="dato" value= "{{ precio }}"/>
                                        <p><strong> Datos </strong></p>
                                    </center>
                                    <div class="clearfix"></div>
                                    </div>
                            </div>
                        
                        
                        </div>
                        
                
                
                   
                    </div>			            
                  </div>


                    </div>
                     
                       
                      
                    </div>


                
                
            

            </div>
         
        
    </div>
    <div class="modal-footer">
      
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
    </div>


    </div>
</div>


        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->

<!-- /.modal -->

 

<script>
    
    var matricula=0;
    function showModalPago(id){
        matricula=id;
    
    
    let url='ModalPay/?matricula='+id;
    fetch(url,{
        mode: 'no-cors',
      method: 'get'
    }).then(function(result){
    
    return result.text();
    
    }).then(function(result){
        
        let unit=document.getElementById("modalContent").innerHTML=result;
    
    });
        $("#PayMatricula").modal("show");
        
        matricula=id;
    
    
    let url2='GetPrice/?matricula='+id;
    fetch(url2,{
        mode: 'no-cors',
      method: 'get'
    }).then(function(result){
    
    return result.text();
    
    }).then(function(result){
        
        let unit2=result;
        precio(unit2);
    
    });
        
        

       
      
    }
    
    function showModalPaypal(id){
        matricula=id;
    
    

       $("#PayMatriculaPaypal").modal("show");
      // initPayPalButton();
    
       
      
    }
    
    
    
    
    </script>
    
    
    <script>
    
    
    function enviardt(a){
     //function enviar(a){
        un.value=g1;
     cant.value=g2; 
         if (a==1)
        {
            
     location.href = "{%url 'ModalPayDetail'%}" ;
        } 
        
        else if(a==2)
        {
    
    location.href = "{%url 'ModalPayDetail2'%}" ;
        } 
    
    
    }
    
    
    
    </script>
    
    
<script>


    function enviarST(){
    
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "updateEnrollment/"); 
    xhr.onload = function(event){ 
    alert("Success, server responded with: " + event.target.response); // raw response
    location.href = "" ;
    }; 
    // or onerror, onabort
    var formData = new FormData(document.getElementById("enroll")); 
    formData.append('id', matricula);
    xhr.send(formData);
    
    
    
    
    }
    
    
    
    </script>
    
     <script src="https://www.paypal.com/sdk/js?client-id=sb&enable-funding=venmo&currency=USD" data-sdk-integration-source="button-factory"></script>
      <script>
      var cantidad = document.getElementById("dato");
      alert (cantidad);
      alert (dato.value);
      var cc = dato.value;

      function precio(usd){
          cc=usd;
      

      }
        function initPayPalButton() {
          paypal.Buttons({
            style: {
              shape: 'pill',
              color: 'black',
              layout: 'vertical',
              label: 'pay',
              
            },
            
    
            createOrder: function(data, actions) {
              return actions.order.create({
                purchase_units: [{"amount":{"currency_code":"USD","value":cc}}]
              });
            },
    
            onApprove: function(data, actions) {
              return actions.order.capture().then(function(orderData) {
                
                // Full available details
               // console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
                
               // console.log(orderData.status);
                console.log(orderData.payer.email_address);
                console.log(orderData.payer.payer_id);
                
                console.log(orderData.purchase_units[0].payments.captures[0].status);
                // []
               console.log(orderData.purchase_units[0].payments.captures[0].id);
               console.log(orderData.purchase_units[0].payments.captures[0].final_capture);
               console.log(orderData.purchase_units[0].payments.captures[0].amount.value);
               console.log(orderData.purchase_units[0].payments.captures[0].amount.currency_code);
                
                
    
                // Show a success message within this page, e.g.
                const element = document.getElementById('paypal-button-container');
                element.innerHTML = '';
                element.innerHTML = '<h3>Thank you for your payment!</h3>';
    
                // Or go to another URL:  actions.redirect('thank_you.html');
                
              });
            },
    
            onError: function(err) {
              console.log(err);
            }
          }).render('#paypal-button-container');
        }
        initPayPalButton();
      </script>
    

    
{% endblock content %}
	
<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
{% endblock javascripts %}
